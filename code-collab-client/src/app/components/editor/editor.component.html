<div class="editor-container">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="room-info">
      <span class="room-label">Room ID:</span>
      <span class="room-id">{{ roomId }}</span>
      <button mat-icon-button (click)="copyRoomId()" matTooltip="Copy Room ID">
        <mat-icon>content_copy</mat-icon>
      </button>
    </div>


    <div class="language-selector">
      <mat-form-field appearance="outline">
        <mat-label>Language</mat-label>
        <mat-select [formControl]="selectedLanguage">
          <mat-option *ngFor="let lang of languages" [value]="lang.id">
            {{ lang.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="action-buttons">
      <button mat-raised-button color="primary" [disabled]="isExecuting" (click)="executeCode()">
        <mat-icon>play_arrow</mat-icon>
        Run
      </button>
      <button mat-raised-button color="warn" (click)="leaveRoom()">
        <mat-icon>exit_to_app</mat-icon>
        Leave Room
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Left Panel - Chat -->
    <div class="panel chat-panel" [class.collapsed]="!isLeftPanelOpen">
      <div class="panel-header">
        <h3>Chat</h3>
        <button mat-icon-button (click)="toggleLeftPanel()">
          <mat-icon>{{ isLeftPanelOpen ? 'chevron_left' : 'chevron_right' }}</mat-icon>
        </button>
      </div>
      <div class="chat-messages" #chatContainer>
        <div *ngFor="let message of messages" class="message" [ngClass]="{'system-message': message.type === 'system', 'own-message': message.userName === currentUser?.name}">
          <div class="message-header">
            <span class="username" [style.color]="getUserColor(message.userName)">{{ message.userName }}</span>
            <span class="timestamp">{{ message.timestamp | date:'shortTime' }}</span>
          </div>
          <div class="message-content" [innerHTML]="message.content"></div>
        </div>
      </div>
      <div class="chat-input">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Send a message</mat-label>
          <input matInput [formControl]="newMessage" (keyup.enter)="sendMessage()">
          <button mat-icon-button matSuffix (click)="sendMessage()">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>

    <!-- Center Panel - Code Editor -->
    <div class="panel editor-panel">
      <div #editorContainer class="monaco-editor-container"></div>
    </div>

    <!-- Right Panel - Input/Output/Users -->
    <div class="panel right-panel" [class.collapsed]="!isRightPanelOpen">
      <div class="panel-toggle">
        <button mat-icon-button (click)="toggleRightPanel()">
          <mat-icon>{{ isRightPanelOpen ? 'chevron_right' : 'chevron_left' }}</mat-icon>
        </button>
      </div>

      <!-- Input Section -->
      <div class="panel-section">
        <div class="panel-header">
          <h3>Input</h3>
          <button mat-icon-button (click)="clearInput()" matTooltip="Clear Input">
            <mat-icon>clear</mat-icon>
          </button>
        </div>
        <div class="panel-content">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Program Input</mat-label>
            <textarea matInput [formControl]="codeInput" rows="5" placeholder="Enter program input here..."></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Output Section -->
      <div class="panel-section">
        <div class="panel-header">
          <h3>Output</h3>
          <div *ngIf="isExecuting" class="executing-indicator">
            <mat-spinner diameter="20"></mat-spinner>
            <span>Executing...</span>
          </div>
        </div>
        <div class="panel-content output-content">
          <pre *ngIf="execution && execution.output">{{ execution.output }}</pre>
          <pre *ngIf="execution && execution.error" class="error-output">{{ execution.error }}</pre>
          <div *ngIf="execution && execution.executionTime" class="execution-stats">
            Executed in {{ execution.executionTime }}ms
          </div>
          <div *ngIf="!execution?.output && !execution?.error && !isExecuting" class="no-output">
            Run your code to see output here
          </div>
        </div>
      </div>

      <!-- Users Section -->
      <div class="panel-section users-section">
        <div class="panel-header">
          <h3>Users ({{ connectedUsers.length }})</h3>
        </div>
        <div class="panel-content">
          <div class="users-list">
            <div *ngFor="let user of connectedUsers" class="user-item">
              <div class="user-color" [style.background-color]="user.color"></div>
              <div class="user-name">{{ user.name }}</div>
              <div class="user-status" [ngClass]="user.status"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
